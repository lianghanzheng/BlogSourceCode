---
import BaseLayout from './BaseLayout.astro';
import ChapterNav from '../components/ChapterNav.astro';

interface Chapter {
  commit: string;
  label: string;
}

interface Props {
  title: string;
  description?: string;
  repo: string;
  chapters?: Chapter[];
}

const { title, description, repo, chapters = [] } = Astro.props;
---

<BaseLayout title={title}>
  <div class="flex gap-12">

    <!-- 左侧：返回链接 + 分割线 -->
    <div class="flex items-start gap-8 shrink-0 pt-4">
      <div class="flex flex-col items-center gap-4 pt-6">
        <a
          href="/blog"
          class="text-coffee/50 hover:text-orange transition-colors duration-300 group flex flex-col items-center gap-2"
        >
          <span class="text-3xl font-serif">←</span>
          <span class="text-xs tracking-[0.2em] uppercase font-medium">Back</span>
        </a>
      </div>

      <!-- 垂直分割线 -->
      <div class="relative w-0.5 h-64 bg-divide mt-8">
        <div class="absolute -top-1 -left-1.5 w-3.5 h-3.5 bg-divide rounded-sm"></div>
        <div class="absolute -bottom-1 -left-1.5 w-3.5 h-3.5 bg-divide rounded-sm"></div>
      </div>
    </div>

    <!-- 右侧：文章内容 -->
    <div class="flex-1 pt-4">
      <article>
        <header class="mb-12 pb-8 border-b border-coffee/10">
          <!-- 三色条带编号卡片 + 标题 -->
          <div class="flex items-start gap-6">
            <!-- 编号卡片（固定使用 01） -->
            <div class="shrink-0 select-none">
              <div class="flex h-20 shadow-lg">
                <!-- 彩色条带 -->
                <div class="w-2 h-full bg-sage"></div>
                <div class="w-2 h-full bg-mustard"></div>
                <div class="w-1.5 h-full bg-dark-strip"></div>
                <!-- 数字方块 -->
                <div class="w-20 h-full flex items-center justify-center bg-coffee">
                  <span class="text-3xl font-black tracking-widest text-orange font-mono">
                    01
                  </span>
                </div>
              </div>
            </div>

            <!-- 标题信息 -->
            <div class="pt-2">
              <h1 class="text-3xl font-serif font-bold text-coffee mb-2">{title}</h1>
              {description && <p class="text-coffee/70 font-serif text-lg mb-2">{description}</p>}
              <p class="text-xs font-mono text-coffee/40">{repo}</p>
            </div>
          </div>
        </header>

        <div class="prose prose-stone prose-lg max-w-none prose-headings:font-serif prose-headings:text-coffee prose-p:text-coffee/80 prose-a:text-orange prose-a:no-underline hover:prose-a:underline prose-code:text-orange prose-code:bg-coffee/5 prose-code:px-1 prose-code:rounded prose-pre:bg-coffee prose-pre:text-cream">
          <slot />
        </div>

        {chapters.length > 0 && (
          <div class="mt-16 pt-8 border-t border-coffee/10">
            <ChapterNav repo={repo} chapters={chapters} />
          </div>
        )}
      </article>
    </div>
  </div>
</BaseLayout>
